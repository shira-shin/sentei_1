# 次世代型リンゴ機能構造植物モデル (FSPM) 設計仕様書

## 1. コンセプト：生命のデジタルツイン

単なる幾何学的な描画ではなく、植物の「生理（機能）」と「形（構造）」が互いに影響し合う動的シミュレーション環境を構築する。剪定によるホルモンバランスの変化や、それによる数年先の収量・樹形への影響を科学的に予測する。

## 2. 生理学的ロジック（植物の知能）

### 2.1 最小単位：メタマー (Metamer)

植物を以下の4要素のセットとして定義し、エネルギー収支の計算単位とする。

- **STEM（茎/節間）**: 資源の通り道。質量を持ち、パイプモデル理論に従い太さが変化する。
- **LEAF（葉）**: 光合成エンジン。受光量に基づき炭素（C）を固定する。
- **BUD（芽）**: 次のメタマーを生む成長点。状態は Active, Dormant, Flower, Dead の4種。
- **FRUIT（果実）**: 最も強力なシンク。エネルギーを消費し、種子からジベレリン（GA）を放出する。

### 2.2 物質生産と分配 (Source-Sink)

**光合成モデル (FvCBモデル):**

$$A = \min(A_c, A_j) - R_d$$

個葉の受光量、窒素含有量、温度に基づき二酸化炭素固定量を算出。

**資源分配（シンク強度競合）:**

$$Allocation_i = \frac{S_i}{\sum S_j} \cdot P_{total}$$

果実 > 新梢 > 根 > 貯蔵（木）の順でエネルギーを分配。

**隔年結果 (Biennial Bearing):**
果実内の種子から放出されるジベレリンが、翌年のための花芽分化を阻害する。

$$P(Flower) \propto \frac{C}{GA_{fruit}}$$

### 2.3 ホルモン制御（頂芽優勢）

**極性輸送モデル:**
先端（頂芽）から流れるオーキシン（IAA）が下方の芽を抑制し、根からのサイトカイニン（CK）が芽吹きを促進する。

$$Activation\_Potential = \frac{[CK]_{root}}{[IAA]_{apex} \cdot Distance + \lambda}$$

**剪定の影響:** 頂芽を切除した瞬間、抑制係数が消失し、潜伏芽が「徒長枝」として爆発的に成長する挙動を再現。

## 3. 幾何学的・構造的ロジック（植物の身体）

### 3.1 葉序と分岐 (Geometric Rules)

**黄金角葉序:** 芽の配置は $137.5^\circ$ の螺旋に従い、受光効率を最大化する。

**屈性ベクトル (Tropism):**

$$\vec{V}_{growth} = w_{light} \vec{V}_{sun} + w_{grav} \vec{V}_{up} + w_{inertia} \vec{V}_{parent}$$

光（光屈性）、重力（負の重力屈性）、親枝の方向の3ベクトルを合成して成長方向を決定。

### 3.2 パイプモデル理論 (Mechanical Support)

**太さの動的決定:** ある節間の断面積は、その上流にある全葉面積の総和に比例させる。これにより、根元が太く先端が細いテーパー表現を自動生成する。

**物理的しなり:** 果実の重量と枝の弾性係数に基づき、枝の垂れ下がりを計算。角度の変化がホルモン流動（頂芽優勢の弱まり）にフィードバックされる。

## 4. 品種特異性プロファイル (Genotype DNA)

各品種の個性をパラメーターセットで管理する。

| パラメーター | ふじ (Fuji) | 王林 (Orin) | わい性台木 (M.9) |
| --- | --- | --- | --- |
| 頂芽優勢強度 | 0.85 (強) | 0.65 (中) | 0.40 (弱) |
| 初期分岐角度 | 45° (直立) | 70° (開張) | 50° |
| 節間長ベース | 5.0 cm | 4.0 cm | 2.5 cm |
| 花芽形成率 | 中 | 高 | 極めて高 |
| 隔年結果感受性 | 高 | 中 | 低 |

## 5. ユーザーエクスペリエンス (UI/UX)

### 5.1 ビジュアルデザイン

- **「ラボ感」の演出:** 深いネイビーグレー（#0d1117）の背景に、精密なグリッドを表示。
- **アクティブ表示:** 成長可能性の高い芽をライムグリーンで発光（Glow）させ、次にどこが伸びるかを可視化。
- **オーガニック描画:** Three.jsを用い、ポリゴンを感じさせない滑らかなテーパーと質感を追求。

### 5.2 操作とフィードバック

- **剪定インタラクション:** ハサミカーソルによる物理的切断。切られた枝は重力で落下する。
- **診断ダッシュボード:**
  - **T/Rバランス天秤:** 地上部と根の比率を可視化。
  - **NSC（貯蔵養分）ゲージ:** 木の「体力」を表示。
  - **収穫予測予測器:** 今年の予想収量をリンゴ箱の数で表示。

## 6. システムアーキテクチャ

- **Backend (Physiology Engine):** Python / FastAPI
  - 微分方程式、行列演算、生理学計算、AI剪定最適化。
- **Frontend (Visual Engine):** Next.js / Three.js (React Three Fiber)
  - リアルタイム3D描画、UIコンポーネント、WebSocket通信。
- **Data Persistence:** Firestore（オプション）
  - 剪定パターンの保存、成長ログの蓄積。

## 7. 現実との乖離を防ぐ工夫

- **自己剪定ロジック:** 光合成効率がマイナスになった影の枝は自動的に枯死・脱落させる。
- **確率的ゆらぎ:** 節間長や角度にガウス分布のノイズを加え、一本一本異なる「木の表情」を作る。
- **時間軸の加速:** 冬（剪定）→春（芽吹き）→夏（伸長）→秋（収穫）のサイクルを高速に回し、10年後の樹形を数分でシミュレート。
